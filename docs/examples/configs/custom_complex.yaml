platform:
  bronze:
    s3_bucket: "enterprise-bronze"
    s3_prefix: "bronze/custom"
    partitioning:
      use_dt_partition: true

sources:
  - name: salesforce_accounts
    source:
      type: "custom"
      system: "salesforce"
      table: "accounts"
      custom_extractor:
        module: "custom_extractors.salesforce"
        class_name: "SalesforceExtractor"
      salesforce:
        username_env: "SF_USER"
        password_env: "SF_PASS"
        token_env: "SF_TOKEN"
        soql_query: |
          SELECT Id, Name, LastModifiedDate FROM Account WHERE IsDeleted = false
        incremental:
          cursor_field: "LastModifiedDate"
          cursor_type: "timestamp"
      run:
        load_pattern: "cdc"
        write_parquet: true
        write_csv: true
        max_rows_per_file: 100000
        parallel_workers: 6
        require_checksum: true
  - name: service_requests
    source:
      type: "custom"
      system: "service_desk"
      table: "tickets"
      custom_extractor:
        module: "custom_extractors.service_desk"
        class_name: "ServiceDeskExtractor"
      service_desk:
        api_user_env: "SD_USER"
        api_key_env: "SD_API_KEY"
        query: "SELECT * FROM tickets WHERE updated >= NOW() - INTERVAL '1 day'"
      run:
        load_pattern: "full"
        write_parquet: true
        write_csv: false
        max_rows_per_file: 250000

silver:
  write_parquet: true
  write_csv: true
  partitioning:
    columns: ["is_current"]
  schema:
    rename_map:
      Id: entity_id
      LastModifiedDate: updated_at
    column_order:
      - entity_id
      - name
      - updated_at
      - is_current
  normalization:
    trim_strings: true
    empty_strings_as_null: true
  error_handling:
    enabled: true
    max_bad_records: 25
    max_bad_percent: 0.25
  require_checksum: true
