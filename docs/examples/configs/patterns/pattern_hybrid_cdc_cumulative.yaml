environment: dev  # Cumulative hybrid CDC scenario
pattern_id: pattern5_hybrid_cdc_cumulative
domain: retail_demo  # Business domain used in Bronze/Silver paths
system: retail_demo  # System name included in each partition directory
entity: orders  # Entity/table alias guiding dataset instrumentation

storage:
  source:
    backend: s3
    bucket: mdf
    prefix: source_samples/
  bronze:
    backend: s3
    bucket: mdf
    prefix: bronze_samples/
  silver:
    backend: s3
    bucket: mdf
    prefix: silver_samples/

# To revert to local storage, switch the backend values to "local" and update the prefixes
# (e.g., source prefix ./sampledata/source_samples/, bronze prefix sampledata/bronze_samples/, silver prefix sampledata/silver_samples/)

path_structure:
  sample_key: "sample"
  system_key: "system"
  entity_key: "table"
  date_key: "dt"
  silver_model_key: "silver_model"
  domain_key: "domain"
  load_date_key: "load_date"

bronze:
  enabled: true
  source_type: file
  path_pattern: sample=pattern5_hybrid_cdc_cumulative/system=retail_demo/table=orders/dt=2025-11-24/delta/delta-part-0001.csv
  partition_column: run_date
  options:
    format: csv
    load_pattern: cdc
    pattern_folder: pattern5_hybrid_cdc_cumulative
    delta_mode: cumulative  # Each delta folder builds on all prior data
    match_dir: delta
    output_formats:
      # - csv
      - parquet

silver:
  enabled: true
  entity_kind: derived_state
  history_mode: scd2
  delete_mode: ignore
  schema_mode: allow_new_columns
  natural_keys:
    - order_id
  change_ts_column: changed_at
  event_ts_column: changed_at
  attributes:
    - status
    - delta_tag
  partition_by:
    - event_ts_dt
  record_time_column: "changed_at"
  record_time_partition: "effective_from_date"
  load_batch_id_column: "load_batch_id"
