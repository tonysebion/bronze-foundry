environment: dev  # Target environment for CDC sample runs
pattern_id: pattern2_cdc_events  # Unique identifier for tracing across source → bronze → silver
domain: retail_demo  # Logical business domain inside sampledata/ hierarchy
system: retail_demo  # Logical system label repeated under system= folders
entity: orders  # Entity/table driving Bronze/Silver paths

storage:
  source:
    backend: s3
    bucket: mdf
    prefix: source_samples/
  bronze:
    backend: s3
    bucket: mdf
    prefix: bronze_samples/
  silver:
    backend: s3
    bucket: mdf
    prefix: silver_samples/

# To use local filesystem instead of S3, change each backend to "local"
# and point the prefixes at local directories, e.g.:
# storage:
#   source:
#     backend: local
#     prefix: ./sampledata/source_samples/
#   bronze:
#     backend: local
#     prefix: sampledata/bronze_samples/
#   silver:
#     backend: local
#     prefix: sampledata/silver_samples/

path_structure:
  sample_key: "sample"  # Bronze folder representing pattern id hierarchy
  system_key: "system"
  entity_key: "table"
  date_key: "dt"
  silver_model_key: "silver_model"
  domain_key: "domain"
  load_date_key: "load_date"

bronze:
  enabled: true  # CDC delta snapshots that append to history
  source_type: file
  path_pattern: sample=pattern2_cdc_events/system=retail_demo/table=orders/dt=2025-11-13/cdc-part-0001.csv
  partition_column: run_date
  options:
    format: csv
    load_pattern: cdc
    pattern_folder: pattern2_cdc_events
    max_rows_per_file: 150000
    partitioning_strategy: batch_id  # Group deltas by incremental batch id
    reference_mode:
      role: delta  # Marks Bronze partition as a delta chunk for Silver
      cadence_days: 1
    output_formats:
      # - csv
      - parquet

silver:
  enabled: true  # Silver reads the append-only log for CDC events
  entity_kind: event
  input_mode: append_log  # Appends every chunk, preserving duplicates
  delete_mode: ignore
  schema_mode: allow_new_columns
  natural_keys:
    - order_id
  event_ts_column: changed_at
  attributes:
    - status
    - order_total
    - customer_id
    - change_type
  partition_by:
    - UpdatedAt_dt  # Derived partition key (by date)
  # V1 Unified temporal configuration: partition by record time, not load time
  record_time_column: "changed_at"
  record_time_partition: "event_date"
  load_batch_id_column: "load_batch_id"
