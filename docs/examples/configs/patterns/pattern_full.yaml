environment: dev  # Target environment this pattern simulates
pattern_id: pattern1_full_events  # Unique identifier for tracing across source → bronze → silver
domain: retail_demo  # Business domain for the dataset (appears in sample paths)
system: retail_demo  # Logical system name used in Bronze/Silver metadata
entity: orders  # Table/entity name referenced throughout the fixtures

# ============================================================================
# PATH STRUCTURE
# Define the folder prefixes used across storage layers; reorder or rename these
# keys to adjust how Bronze/Silver directories are constructed.
# ============================================================================
path_structure:
  bronze:
    system_key: "system"  # Bronze path component for system
    entity_key: "table"  # Bronze path component for entity
    pattern_key: "pattern"  # Bronze path component for pattern
    date_key: "dt"  # Bronze path component for partition date
  silver:
    domain_key: "domain"  # Silver: business domain (curated data organization)
    entity_key: "entity"  # Silver: curated entity/dataset name
    version_key: "v"  # Silver: schema/transformation version prefix
    pattern_key: "pattern"  # Silver: optional pattern for Bronze traceability
    load_date_key: "load_date"  # Silver: data load date

# ============================================================================
# STORAGE CONFIGURATION
# Platform/infrastructure settings - controls where data is read from and written to
# Easy toggle between local filesystem and S3 storage
# ============================================================================
storage:
  # SOURCE: Where to read source files from
  source:
    backend: s3  # "local" or "s3"
    prefix: source_samples/  # Base path prefix within bucket (or base directory for local)

  # BRONZE: Where to write Bronze chunks
  bronze:
    backend: s3  # "local" or "s3"
    prefix: bronze_samples/  # Path prefix within bucket (or base directory for local)

  # SILVER: Where to read Bronze and write Silver artifacts
  silver:
    backend: s3  # "local" or "s3"
    prefix: silver_samples/  # Path prefix within bucket (or base directory for local)

# To switch back to local filesystem, change all backends to "local" and update prefixes:
# storage:
#   source:
#     backend: local
#     prefix: ./sampledata/source_samples/
#   bronze:
#     backend: local
#     prefix: sampledata/bronze_samples/
#   silver:
#     backend: local
#     prefix: sampledata/silver_samples/

bronze:
  enabled: true  # Bronze writes are required; full snapshots rewrite entire partition
  source_type: file  # Using filesystem-based sample data

  # Path pattern for source files - relative to storage.source.bucket/prefix
  # The storage section defines WHERE (s3 vs local, which bucket)
  # This defines WHAT (which specific files/pattern within that location)
  path_pattern: sample=pattern1_full_events/system=retail_demo/table=orders/dt=2025-11-13/full-part-0001.parquet

  partition_column: run_date  # Column Bronze uses for partitioning metadata
  options:
    format: parquet  # Source sample format (used when regenerating)
    load_pattern: full  # Load pattern label exposed via metadata
    pattern_folder: pattern1_full_events  # Directory under bronze_samples
    max_rows_per_file: 250000  # Approximate file size threshold
    partitioning_strategy: date  # Hints how run dates map to partitions
    output_formats:
      # - csv  # Leave CSV commented out so only parquet is emitted
      - parquet

silver:
  enabled: true  # Programmatic Silver promotion is enabled for this pattern
  include_pattern_folder: true  # Include pattern in path for Bronze traceability
  entity_kind: event  # This dataset behaves like an event log
  input_mode: replace_daily  # Each run rewrites the entire partition
  delete_mode: ignore
  schema_mode: allow_new_columns  # Silver tolerates new columns arriving over time
  natural_keys:
    - order_id
  event_ts_column: updated_at  # Primary timestamp for events
  attributes:
    - status
    - order_total
  partition_by:
    - event_ts_dt  # Derived partition column (e.g., event_date)
  # V1 Unified temporal configuration: partition by record time, not load time
  record_time_column: "updated_at"  # Column with event occurrence time
  record_time_partition: "event_date"  # Partition key name for event date
  load_batch_id_column: "load_batch_id"  # Standard column for batch tracking
